<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Профиль</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Comfortaa", sans-serif;
        }
        body {
            background: rgba(171, 24, 3, 1);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }
        .profile-card {
            
            border-radius: 48px;
            padding: 2.5rem 2rem;
            max-width: 450px;
            width: 100%;
			
            
        }
        .profile-header {
            text-align: center;
            margin-bottom: 2rem;
        }
        .profile-name {
            font-size: 2rem;
            font-weight: 700;
            color: #162742;
            margin-bottom: 0.25rem;
			color: white;
        }
        .profile-email {
            color: #5b719b;
            font-size: 0.95rem;
			color: white;
        }
        .edit-section {
            background: #f5f9ff;
            border-radius: 32px;
            padding: 1.5rem;
            margin: 1.5rem 0;
        }
        .edit-title {
            font-weight: 600;
            color: #1f2e50;
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }
        .input-group {
            margin-bottom: 1rem;
        }
        .input-group label {
            display: block;
            font-size: 0.85rem;
            font-weight: 600;
            color: #4a5f88;
            margin-bottom: 0.3rem;
        }
        .input-group input {
            width: 100%;
            padding: 0.9rem 1.2rem;
            border: 2px solid #d9e3f5;
            border-radius: 40px;
            font-size: 1rem;
            background: white;
        }
        .input-group input:focus {
            border-color: #2f4b7c;
            outline: none;
        }
        .save-btn {
            background: #1f2e50;
            color: white;
            border: none;
            padding: 0.8rem 1.8rem;
            border-radius: 40px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            font-size: 1rem;
        }
        .save-btn:hover {
            background: #2b3b60;
        }
        .success-message {
            color: #1f7b4d;
            background: #e0f5e9;
            padding: 0.8rem;
            border-radius: 40px;
            text-align: center;
            margin-top: 1rem;
            font-size: 0.9rem;
        }
        .empty-message {
            
            padding: 2rem;
            color: white;
            font-size: 1.2rem;
            
            margin: 1.5rem 0;
            text-align: center;
        }
        .button-group {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 1.5rem;
        }
        .btn {
            background: #1f2e50;
            color: white;
            border: none;
            padding: 0.8rem 2rem;
            border-radius: 40px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: 0.1s;
            text-decoration: none;
            display: inline-block;
        }
        .btn-secondary {
            background: #dbe3f5;
            color: #1f2e50;
        }
        .btn:hover {
            transform: translateY(-2px);
            filter: brightness(1.05);
        }
        .logout-btn {
            background: #c93e3e;
        }
		
    </style>
</head>
<body>
    <div class="profile-card">
        <div class="profile-header">
            <div class="profile-name" id="profileName">Загрузка...</div>
            <div class="profile-email" id="profileEmail">...</div>
        </div>

        <!-- Секция редактирования имени -->
        <div class="edit-section">
            <div class="edit-title">Изменить имя</div>
            <div class="input-group">
                <label for="newName">Новое имя</label>
                <input type="text" id="newName" placeholder="Введите имя" maxlength="30">
            </div>
            <button class="save-btn" id="saveNameBtn">Сохранить</button>
            <div id="saveMessage" class="success-message" style="display: none;"></div>
        </div>

        
        <div class="empty-message">
            ничего нет.. пока что
        </div>

        <div class="button-group">
            <button class="btn" onclick="window.location.href='https://zoro-game.store/index.html'">На главную страницу</button>
            <button class="btn logout-btn" id="logoutBtn">Выйти из аккаунта</button>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyD2nPoa3nFbO3Y2qBWlqeE-JnWHEV0cYCE",
            authDomain: "zorogamestoreapi.firebaseapp.com",
            databaseURL: "https://zorogamestoreapi-default-rtdb.firebaseio.com",
            projectId: "zorogamestoreapi",
            storageBucket: "zorogamestoreapi.firebasestorage.app",
            messagingSenderId: "163104730922",
            appId: "1:163104730922:web:3bc7c1641169ab93163853"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();

        const profileName = document.getElementById('profileName');
        const profileEmail = document.getElementById('profileEmail');
        const newNameInput = document.getElementById('newName');
        const saveMessage = document.getElementById('saveMessage');

        let currentUser = null;

        auth.onAuthStateChanged(user => {
            if (!user) {
                window.location.href = 'auth.html';
                return;
            }

            currentUser = user;
            profileName.textContent = user.displayName || 'Пользователь';
            profileEmail.textContent = user.email;
            newNameInput.value = user.displayName || '';
        });

        // Сохранение нового имени
        document.getElementById('saveNameBtn').addEventListener('click', async () => {
            if (!currentUser) return;
            
            const newName = newNameInput.value.trim();
            if (!newName) {
                saveMessage.style.display = 'block';
                saveMessage.textContent = 'Имя не может быть пустым';
                saveMessage.style.color = '#c93e3e';
                saveMessage.style.background = '#ffe6e5';
                setTimeout(() => {
                    saveMessage.style.display = 'none';
                }, 3000);
                return;
            }

            try {
                // Обновляем профиль в Firebase Auth
                await currentUser.updateProfile({
                    displayName: newName
                });

                // Также сохраняем имя в Realtime Database для комментариев (на всякий случай)
                await db.ref('users/' + currentUser.uid + '/displayName').set(newName);

                // Обновляем отображение
                profileName.textContent = newName;

                saveMessage.style.display = 'block';
                saveMessage.textContent = 'Имя успешно обновлено!';
                saveMessage.style.color = '#1f7b4d';
                saveMessage.style.background = '#e0f5e9';

                setTimeout(() => {
                    saveMessage.style.display = 'none';
                }, 3000);

            } catch (error) {
                saveMessage.style.display = 'block';
                saveMessage.textContent = 'Ошибка: ' + error.message;
                saveMessage.style.color = '#c93e3e';
                saveMessage.style.background = '#ffe6e5';
                setTimeout(() => {
                    saveMessage.style.display = 'none';
                }, 3000);
            }
        });

        document.getElementById('logoutBtn').addEventListener('click', async () => {
            await auth.signOut();
            window.location.href = 'auth.html';
        });
    </script>
</body>
</html>